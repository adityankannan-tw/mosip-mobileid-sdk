{"version":3,"names":["React","StyleSheet","Text","View","TouchableOpacity","ImageBackground","Camera","CameraType","authenticateFace","FaceDetector","camera","FaceAuth","Component","constructor","props","setState","capturedImage","previewVisible","cameraType","state","front","back","photo","takePictureAsync","result","data","authentication","console","log","retakePicture","backgroundColor","flex","width","height","uri","styles","imgBackground","flexDirection","borderRadius","justifyContent","alignItems","color","fontSize","alignContent","Error","render","container","__retakePicture","r","mode","FaceDetectorMode","fast","detectLandmarks","FaceDetectorLandmarks","all","runClassifications","FaceDetectorClassifications","minDetectionInterval","tracking","position","bottom","right","__switchCamera","fontWeight","padding","alignSelf","authenticatePhoto","create"],"sources":["FaceAuth.tsx"],"sourcesContent":["import React, { Props, useEffect, useState } from 'react';\r\nimport {StyleSheet, Text, View, TouchableOpacity, Alert, ImageBackground, Image, Route} from 'react-native'\r\nimport {Camera, CameraCapturedPicture, CameraType} from 'expo-camera'\r\nimport authenticateFace from \"./AuthenticationService\"\r\nimport * as FaceDetector from 'expo-face-detector';\r\n\r\nlet camera:Camera;\r\n\r\nexport interface FaceAuthProps {\r\n  data:string;\r\n  onValidationSuccess: () => void;\r\n};\r\n\r\ntype State = {\r\n  authentication: boolean;\r\n  previewVisible: boolean;\r\n  capturedImage: CameraCapturedPicture|null;\r\n  cameraType: CameraType;\r\n\r\n};\r\n\r\nexport default class FaceAuth extends React.Component<FaceAuthProps, State> {\r\n\r\n\r\n  constructor(props: FaceAuthProps) {\r\n    super(props);\r\n\r\n    if (props.data === null) {\r\n      throw new Error('Please send VC face image');\r\n    }\r\n\r\n    this.state = {\r\n      authentication: false,\r\n      previewVisible: false,\r\n      capturedImage: null,\r\n      cameraType: CameraType.front\r\n    };\r\n  }\r\n\r\n  __retakePicture = () => {\r\n    this.setState({\r\n      capturedImage: null,\r\n      previewVisible: false\r\n    });\r\n    \r\n  }\r\n  \r\n  __switchCamera = () => {\r\n    this.setState({cameraType: (this.state.cameraType === 'back' ? CameraType.front : CameraType.back)});\r\n  }\r\n\r\n  authenticatePhoto = async () => {\r\n    const photo:CameraCapturedPicture = await camera.takePictureAsync();\r\n    this.setState({capturedImage: photo, previewVisible: true});\r\n\r\n    const result:boolean = authenticateFace(this.state.capturedImage, this.props.data);\r\n    this.setState({authentication: result});\r\n    console.log('result ----- ' + result);\r\n  }\r\n\r\n  CameraPreview = ({photo, retakePicture}: any) => {\r\n    return (\r\n        \r\n      <View style={{backgroundColor: 'transparent', flex: 1, width: '100%', height: '100%'}}>\r\n        <ImageBackground source={{uri: photo.uri}} style={{flex: 1}}>\r\n          <View style={styles.imgBackground}>\r\n            <View style={{flexDirection: 'column'}}>\r\n              {this.state.authentication === true ? \r\n                    (<Text style={{borderRadius: 4, backgroundColor: '#fff',\r\n                    flexDirection: 'row', justifyContent: 'center', alignItems: 'center', height: 40, color: 'green',fontSize: 20, alignContent: 'center'}}>Authentication Successful</Text>) : \r\n                    (<TouchableOpacity onPress={retakePicture} style={{borderRadius: 4, backgroundColor: '#14274e',\r\n                    flexDirection: 'row', justifyContent: 'center', alignItems: 'center', height: 40}}>\r\n                    <Text style={{ color: 'red', fontSize: 20}}>Authentication failed, Try again</Text>\r\n                  </TouchableOpacity>)}\r\n            </View>\r\n          </View>\r\n        </ImageBackground>\r\n      </View>\r\n    )\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <View style={styles.container}>\r\n      <View style={{flex: 1,width: '100%'}}>\r\n          {this.state.previewVisible ? (\r\n            <this.CameraPreview photo={this.state.capturedImage} retakePicture={this.__retakePicture} />\r\n          ) : (\r\n            <Camera type={this.state.cameraType} style={{flex: 1}} ref={(r:Camera) => { camera = r }}\r\n            faceDetectorSettings={{mode: FaceDetector.FaceDetectorMode.fast, detectLandmarks: FaceDetector.FaceDetectorLandmarks.all,\r\n              runClassifications: FaceDetector.FaceDetectorClassifications.all, minDetectionInterval: 100, tracking: true}}>\r\n              <View style={{flex: 1, width: '100%', backgroundColor: 'transparent', flexDirection: 'row'}}>\r\n                <View style={{position: 'absolute', bottom: 30, flex: 1, right: '5%',  flexDirection: 'row', justifyContent: 'space-between'}}>\r\n                  <TouchableOpacity onPress={this.__switchCamera}>\r\n                    <Text style={{backgroundColor: '#14274e',\r\n                    alignItems: 'center',fontSize: 20,color: '#fff', fontWeight:'bold'}}>Switch Camera</Text>\r\n                  </TouchableOpacity>\r\n                </View>\r\n                <View style={{position: 'absolute', bottom: 0,flexDirection: 'row',flex: 1,width: '100%',padding: 20,justifyContent: 'space-between'}}>\r\n                  <View style={{alignSelf: 'center', flex: 1,alignItems: 'center'}}>\r\n                    <TouchableOpacity onPress={this.authenticatePhoto} style={{width: 70,height: 70,bottom: 0,borderRadius: 50, backgroundColor: '#fff'}}/>\r\n                  </View>\r\n                </View>\r\n              </View>\r\n            </Camera>\r\n          )}\r\n        </View>\r\n    </View>\r\n    )\r\n}\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    backgroundColor: '#fff',\r\n    alignItems: 'center',\r\n    justifyContent: 'center'\r\n  },\r\n  imgBackground: {\r\n    flex: 1,flexDirection: 'column',padding: 15,justifyContent: 'flex-end'\r\n  }\r\n})\r\n\r\nfunction render() {\r\n    throw new Error('Function not implemented.');\r\n}\r\n"],"mappings":"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"}