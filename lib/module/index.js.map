{"version":3,"names":["React","StyleSheet","Text","View","TouchableOpacity","ImageBackground","Camera","CameraType","authenticateFace","FaceDetector","camera","FaceAuth","Component","constructor","props","setState","capturedImage","previewVisible","cameraType","state","front","back","photo","takePictureAsync","result","data","authentication","onValidationSuccess","retakePicture","backgroundColor","flex","width","height","uri","styles","imgBackground","flexDirection","borderRadius","justifyContent","alignItems","color","fontSize","alignContent","Error","render","container","__retakePicture","r","mode","FaceDetectorMode","fast","detectLandmarks","FaceDetectorLandmarks","all","runClassifications","FaceDetectorClassifications","minDetectionInterval","tracking","position","bottom","right","__switchCamera","fontWeight","padding","alignSelf","authenticatePhoto","create"],"sources":["index.tsx"],"sourcesContent":["import React from \"react\";\r\nimport {\r\n  StyleSheet,\r\n  Text,\r\n  View,\r\n  TouchableOpacity,\r\n  ImageBackground,\r\n} from \"react-native\";\r\nimport { Camera, CameraCapturedPicture, CameraType } from \"expo-camera\";\r\nimport authenticateFace from \"./AuthenticationService\";\r\nimport * as FaceDetector from \"expo-face-detector\";\r\n\r\nlet camera: Camera;\r\n\r\nexport interface FaceAuthProps {\r\n  data: string;\r\n  onValidationSuccess: () => void;\r\n}\r\n\r\ntype State = {\r\n  authentication: boolean;\r\n  previewVisible: boolean;\r\n  capturedImage: CameraCapturedPicture | null;\r\n  cameraType: CameraType;\r\n};\r\n\r\nexport default class FaceAuth extends React.Component<FaceAuthProps, State> {\r\n  constructor(props: FaceAuthProps) {\r\n    super(props);\r\n\r\n    if (props.data === null) {\r\n      throw new Error(\"Please send VC face image\");\r\n    }\r\n\r\n    this.state = {\r\n      authentication: false,\r\n      previewVisible: false,\r\n      capturedImage: null,\r\n      cameraType: CameraType.front,\r\n    };\r\n  }\r\n\r\n  __retakePicture = () => {\r\n    this.setState({\r\n      capturedImage: null,\r\n      previewVisible: false,\r\n    });\r\n  };\r\n\r\n  __switchCamera = () => {\r\n    this.setState({\r\n      cameraType:\r\n        this.state.cameraType === \"back\" ? CameraType.front : CameraType.back,\r\n    });\r\n  };\r\n\r\n  authenticatePhoto = async () => {\r\n    const photo: CameraCapturedPicture = await camera.takePictureAsync();\r\n    this.setState({ capturedImage: photo, previewVisible: true });\r\n\r\n    const result: boolean = authenticateFace(\r\n      this.state.capturedImage,\r\n      this.props.data\r\n    );\r\n    this.setState({ authentication: result });\r\n    if (result) {\r\n      this.props.onValidationSuccess();\r\n    }\r\n  };\r\n\r\n  CameraPreview = ({ photo, retakePicture }: any) => {\r\n    return (\r\n      <View\r\n        style={{\r\n          backgroundColor: \"transparent\",\r\n          flex: 1,\r\n          width: \"100%\",\r\n          height: \"100%\",\r\n        }}\r\n      >\r\n        <ImageBackground source={{ uri: photo.uri }} style={{ flex: 1 }}>\r\n          <View style={styles.imgBackground}>\r\n            <View style={{ flexDirection: \"column\" }}>\r\n              {this.state.authentication === true ? (\r\n                <Text\r\n                  style={{\r\n                    borderRadius: 4,\r\n                    backgroundColor: \"#fff\",\r\n                    flexDirection: \"row\",\r\n                    justifyContent: \"center\",\r\n                    alignItems: \"center\",\r\n                    height: 40,\r\n                    color: \"green\",\r\n                    fontSize: 20,\r\n                    alignContent: \"center\",\r\n                  }}\r\n                >\r\n                  Authentication Successful\r\n                </Text>\r\n              ) : (\r\n                <TouchableOpacity\r\n                  onPress={retakePicture}\r\n                  style={{\r\n                    borderRadius: 4,\r\n                    backgroundColor: \"#14274e\",\r\n                    flexDirection: \"row\",\r\n                    justifyContent: \"center\",\r\n                    alignItems: \"center\",\r\n                    height: 40,\r\n                  }}\r\n                >\r\n                  <Text style={{ color: \"red\", fontSize: 20 }}>\r\n                    Authentication failed, Try again\r\n                  </Text>\r\n                </TouchableOpacity>\r\n              )}\r\n            </View>\r\n          </View>\r\n        </ImageBackground>\r\n      </View>\r\n    );\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <View style={styles.container}>\r\n        <View style={{ flex: 1, width: \"100%\" }}>\r\n          {this.state.previewVisible ? (\r\n            <this.CameraPreview\r\n              photo={this.state.capturedImage}\r\n              retakePicture={this.__retakePicture}\r\n            />\r\n          ) : (\r\n            <Camera\r\n              type={this.state.cameraType}\r\n              style={{ flex: 1 }}\r\n              ref={(r: Camera) => {\r\n                camera = r;\r\n              }}\r\n              faceDetectorSettings={{\r\n                mode: FaceDetector.FaceDetectorMode.fast,\r\n                detectLandmarks: FaceDetector.FaceDetectorLandmarks.all,\r\n                runClassifications:\r\n                  FaceDetector.FaceDetectorClassifications.all,\r\n                minDetectionInterval: 100,\r\n                tracking: true,\r\n              }}\r\n            >\r\n              <View\r\n                style={{\r\n                  flex: 1,\r\n                  width: \"100%\",\r\n                  backgroundColor: \"transparent\",\r\n                  flexDirection: \"row\",\r\n                }}\r\n              >\r\n                <View\r\n                  style={{\r\n                    position: \"absolute\",\r\n                    bottom: 30,\r\n                    flex: 1,\r\n                    right: \"5%\",\r\n                    flexDirection: \"row\",\r\n                    justifyContent: \"space-between\",\r\n                  }}\r\n                >\r\n                  <TouchableOpacity onPress={this.__switchCamera}>\r\n                    <Text\r\n                      style={{\r\n                        backgroundColor: \"#14274e\",\r\n                        alignItems: \"center\",\r\n                        fontSize: 20,\r\n                        color: \"#fff\",\r\n                        fontWeight: \"bold\",\r\n                      }}\r\n                    >\r\n                      Switch Camera\r\n                    </Text>\r\n                  </TouchableOpacity>\r\n                </View>\r\n                <View\r\n                  style={{\r\n                    position: \"absolute\",\r\n                    bottom: 0,\r\n                    flexDirection: \"row\",\r\n                    flex: 1,\r\n                    width: \"100%\",\r\n                    padding: 20,\r\n                    justifyContent: \"space-between\",\r\n                  }}\r\n                >\r\n                  <View\r\n                    style={{\r\n                      alignSelf: \"center\",\r\n                      flex: 1,\r\n                      alignItems: \"center\",\r\n                    }}\r\n                  >\r\n                    <TouchableOpacity\r\n                      onPress={this.authenticatePhoto}\r\n                      style={{\r\n                        width: 70,\r\n                        height: 70,\r\n                        bottom: 0,\r\n                        borderRadius: 50,\r\n                        backgroundColor: \"#fff\",\r\n                      }}\r\n                    />\r\n                  </View>\r\n                </View>\r\n              </View>\r\n            </Camera>\r\n          )}\r\n        </View>\r\n      </View>\r\n    );\r\n  }\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    backgroundColor: \"#fff\",\r\n    alignItems: \"center\",\r\n    justifyContent: \"center\",\r\n  },\r\n  imgBackground: {\r\n    flex: 1,\r\n    flexDirection: \"column\",\r\n    padding: 15,\r\n    justifyContent: \"flex-end\",\r\n  },\r\n});\r\n"],"mappings":"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"}